{% comment %}
  HUMANPEA Product Card (ALD-style) – full fixed version
  • Handles featured_media, featured_image, or empty state (placeholder)
  • Hover-swap on second image
  • Shows Sold Out badge
  • Includes Quick Add or Select Options
{% endcomment %}

{%- assign prod = card_product | default: product -%}

{%- assign prim_media = prod.featured_media | default: prod.featured_image -%}
{%- if prim_media and prim_media.preview_image -%}
  {%- assign prim_img = prim_media.preview_image -%}
{%- else -%}
  {%- assign prim_img = prim_media -%}
{%- endif -%}

{%- assign sec_media = prod.media[1] -%}
{%- if sec_media and sec_media.preview_image -%}
  {%- assign sec_img = sec_media.preview_image -%}
{%- else -%}
  {%- assign sec_img = sec_media -%}
{%- endif -%}

{%- assign alt_primary = prod.title | escape -%}
{%- assign alt_secondary = prod.title | escape -%}

<div class="hp-card">
  <a href="{{ prod.url }}" class="hp-card__link" aria-label="{{ prod.title | escape }}">
    <div class="hp-card__media">
      {%- if prim_img -%}
        {{ prim_img
          | image_url: width: 900
          | image_tag: alt: alt_primary, class: 'hp-card__img hp-card__img--primary', loading: 'lazy'
        }}
      {%- else -%}
        {%- capture ph_key -%}product-apparel-{{ forloop.index0 | default: 0 | modulo: 6 | plus: 1 }}{%- endcapture -%}
        {{ ph_key | placeholder_svg_tag: 'hp-card__placeholder' }}
      {%- endif -%}

      {%- if sec_img -%}
        {{ sec_img
          | image_url: width: 900
          | image_tag: alt: alt_secondary, class: 'hp-card__img hp-card__img--secondary', loading: 'lazy'
        }}
      {%- endif -%}

      {%- unless prod.available -%}
        <span class="hp-badge hp-badge--soldout">Sold out</span>
      {%- endunless -%}
    </div>

    <div class="hp-card__meta">
      <h3 class="hp-card__title">{{ prod.title | escape }}</h3>
      <div class="hp-card__price">
        {%- render 'price', product: prod, price_class: 'price--end' -%}
      </div>
    </div>
  </a>

  {%- if prod.available and show_quick_add -%}
    <product-form class="hp-card__quick">
      {%- form 'product', prod, id: 'quick-add-' | append: prod.id, novalidate: 'novalidate' -%}
        {%- if prod.variants.size == 1 and prod.variants.first.available -%}
          <button
            type="submit"
            name="add"
            class="hp-btn hp-btn--quiet"
            data-add-to-cart
          >
            Add to cart
          </button>
        {%- else -%}
          <a href="{{ prod.url }}" class="hp-btn hp-btn--quiet">Select options</a>
        {%- endif -%}
      {%- endform -%}
    </product-form>
  {%- endif -%}
</div>
